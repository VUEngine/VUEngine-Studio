{%- set projectTranslations = project.items.Translations.project -%}
{%- set allTranslations = project.items.Translations | values -%}
{%- set translationIds = [] -%}
{%- set combinedTranslations = {} -%}
{%- for translation in allTranslations -%}
    {%- for translationId, translations in translation.translations %}
        {%- set translationIds = (translationIds.push(translationId), translationIds) -%}
		{%- set combinedTranslations = combinedTranslations | setAttribute(translationId, translations) -%}
    {%- endfor -%}
{%- endfor %}
{%- set translationIds = translationIds | unique | sort -%}
{%- import 'templates/partials/macros.njk' as macros -%}
{% include('templates/partials/fileHeader/fileHeader.c.njk') %}

{{ macros.sectionHeader('Includes') }}

#include <I18n.h>
#include <Languages.h>

{% if projectTranslations.languages | length -%}
{{ macros.sectionHeader('Declarations') }}

{% for language in projectTranslations.languages|sort(attribute='order') -%}
{%- set flagActor = project.items.Actor[language.flagActorId] -%}
{%- if flagActor is defined -%}
	{%- set flagActorName = flagActor._fileUri | basename(false) | sanitizeSpecName ~ 'ActorSpec' -%}
{%- endif -%}
extern LangROMSpec {{ language.code }}LanguageSpec;
{% if flagActorName is defined -%}
extern ActorSpec {{ flagActorName }};
{% endif -%}
{% endfor %}
{% endif -%}
{{ macros.sectionHeader('Definitions') }}

LangROMSpec* const _languages[] =
{
	{% for language in projectTranslations.languages|sort(attribute='order') -%}
	&{{ language.code }}LanguageSpec,
	{% endfor %}
	NULL
};
{%- for language in projectTranslations.languages -%}
{%- set flagActor = project.items.Actor[language.flagActorId] -%}
{%- if flagActor is defined -%}
	{%- set flagActorName = flagActor._fileUri | basename(false) | sanitizeSpecName ~ 'ActorSpec' -%}
{%- endif %}

const char* const {{ language.code }}LanguageStrings[] =
{
    {%- for translationId in translationIds %}
    /* kString{{ translationId | sanitizeSpecName }}: */
    "{{ combinedTranslations[translationId][language.code] | replace('\n', '\\n') | replace('\"', '\\"') | safe }}",
    {%- endfor %}
};

const LangROMSpec {{ language.code }}LanguageSpec =
{
	// language name
	"{{ language.name }}",

	// flag actor
	{% if flagActorName is defined -%}
	&{{ flagActorName }},
	{% else -%}
	NULL,
	{% endif %}
	// strings
	(const char**){{ language.code }}LanguageStrings
};

{%- endfor %}
